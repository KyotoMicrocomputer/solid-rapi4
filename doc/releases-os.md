# SDカードイメージリリースノート

本ドキュメントには[ダウンロードページ](download.md)で配布しているSOLID for Raspberry Pi 4 SDカードイメージの更新履歴が含まれます。

## SOLID-RPi4B-1.3.0

### 機能追加/改善

- Linux
    - Linuxカーネルを v6.6.20 に更新。
    - ベースOSをDebian 12.0 (Bookworm) に更新。
    - `/boot` マウントポイントは `/boot/firmware` に移動。
 
- SOLID
    - カーネルミューテックスのロック解除順序の制約を緩和。（新世代カーネル仕様と同等の動作。第3世代カーネル仕様では `E_OBJ` エラーとなる。)

- OS間通信
    - `SOLID_NET_StrError()` に未知の値が渡された場合に `NULL` を返さないようにした (POSIX `strerror()` と同じ動作)。
    - LinuxカーネルモジュールをLinuxカーネル v6.6 に対応。

### 不具合修正

- Linux
    - 1080p以上の画面解像度のモニタを接続した場合に画面が暗転し、ログインプロンプトが表示されない問題を修正。

- SOLID
    - 未割当てである可能性があるカーネルオブジェクトIDに対する操作とカーネルオブジェクトの生成・削除を同時に行った場合にデータ競合が発生する問題を修正。
    - 未割当てのカーネルオブジェクトIDに対して `rel_mpf`, `wai_sem` を呼び出した場合にカーネル内部のロックが二重に解放される問題を修正。
    - タイムイベントハンドラの生成・削除とハンドラ関数呼出しの間で発生するデータ競合を修正。
    - 優先度継承ミューテックスに対して `tloc_mtx` を呼び出した場合に、呼出し元タスクがタスク優先度順ではなくFIFO順でキューイングされる問題を修正。


## SOLID-RPi4B-1.2.1

### 機能追加/改善
- `.text` セクションのメモリ属性を読取り専用に設定するようにした。
- モジュールをロード中、ロード先領域が無効 (未使用) であることを検証するようにした。
- ベースOSイメージ ([pi-gen](https://github.com/RPi-Distro/pi-gen)) を `c16e6b7de` に更新。

### 不具合修正
- `SOLID_MEM_AllocPA` がアライメント要求を満たさない領域を返すのを修正。
- SOLIDローダーでモジュールをアンロード中、 シンボル未解決状態でも `.[dll_]fini` セクションのコードが実行されるのを修正。
- `trcv_mbf` で送信タスクを待ち解除したときにディスパッチ処理が実行されないのを修正。

## SOLID-RPi4B-1.2.0

### 機能追加/改善
- カーネル関数 `{ras,dis,ena,sns}_ter` をローダブルアプリケーション向けにエクスポート。
- カーネル関数 `aref_{cfg,nid}` (SOLID拡張) をローダブルアプリケーション向けにエクスポート。
- カーネルスピンロックの動的生成を有効化。
- カーネルメッセージバッファを有効化。
- `acre_flg` で `TA_BITCLR` 属性 (SOLID拡張) を指定できるようにした。

## SOLID-RPi4B-1.1.0

### 機能追加/改善
- システムで使用するタスクのエントリポイント名を変更。
- 時刻同期タスクの優先度を `11` から `200` に変更。
  - これにより、時刻同期タスクより高い優先度の段階数が大幅に増えます。

### 不具合修正
- 割込みサービスルーチンは動的生成できないのにも関わらず、動的生成用のメモリが割り当てられているのを修正。
- RTOSビューアーのタスク割付けプロセッサの表示が正しくないのを修正。
- `SOLID_LDR_LoadFile` を実行後、デバッグを終了してから再度開始するとGhostの動作が停止するのを修正。

## SOLID-RPi4B-1.0.0

初版リリース
